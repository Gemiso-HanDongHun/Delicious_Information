<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>

<html lang="ko">

<head>
  <%@include file="../food/include/header_css.jsp" %>

  <!-- jquery -->
  <script src="/js/jquery-3.3.1.min.js"></script>

  <style>

    @font-face {
      font-family: 'MaplestoryOTFBold';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@2.1/MaplestoryOTFBold.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    div li {
      font-family: 'MaplestoryOTFBold';
      font-weight: 800;
    }

    body{
      background: #ffffff;
    }

    .boxed-page {
      min-height: 100vh;
      background-image: url("/images/food-image2.jpg");
      background-size: /*353px 390px*/100% 100%;
      background-repeat: no-repeat;
      margin: 0 0 30px 0;
    }

    .boxed-page-bottom {
      background: #ffffff;
    }

    div.flex-column li a.dropdown-item{ /*drop aÌÉúÍ∑∏ height ÌÅ¨Í∏∞*/
      padding-top: 0;
    }

    #nav-li #navbarDropdown {
      width: 100px;
      padding-top: 60px;
      margin-top: 45px;
      position: absolute;
    }

    #navbar-header .dropdown .dropdown-menu {
      top: 80%;
      display: none;
    }

    #navbar-header .dropdown{
      top:65%;
      height: 1px;
    }

    #navbar-header .dropdown a#navibarDropdown{
      padding-top: 0px;
      top:-34px;
      position: relative;
    }

    #navbar-header .dropdown:hover {
      cursor: pointer;
    }


    div.main-board {
      width: 37%;
      padding: 20px;
      margin: 50px auto;
      box-sizing: border-box;
      border: 2px solid whitesmoke;
      border-radius: 1.5em;
      background: whitesmoke;
    }

    section.main-write{
        width: 100%;
    }

    div.main-board section.main-write div.h1-title {
      width: 50%;
      margin: auto;
    }
    div.main-board section.main-write div.h1-title #h1-title {
      text-align: center;
    }

    div.main-board section.main-write div input:focus {
      outline: none;
      box-shadow: none;
    }

    div.main-board section.main-write label {
      font-weight: 700;
    }

    div.main-board section.main-write div.area1, div.main-board section.main-write div.area2,
    div.main-board section.main-write div.area3, div.main-board section.main-write div.area4 {
      overflow: hidden;
      margin-bottom: 15px;
    }

    div.main-board section.main-write div.area1 div.form-group1 {
      width: 30%;
      float: left;
    }

    div.main-board section.main-write div.area1 div.foodName,
    div.main-board section.main-write div.area1 div.foodKcal{
      margin-right: 5%;
    }


    div.main-board section.main-write div.area2 div.form-group2 {
      width: 30%;
      float: left;
    }

    div.main-board section.main-write div.area2 div.carbohydrate,
    div.main-board section.main-write div.area2 div.protein{
      margin-right: 5%;
    }

    div.main-board section.main-write div.area3 div.form-group3 {
      width: 30%;
      float: left;
    }

    div.main-board section.main-write div.area3 div.vitaminA,
    div.main-board section.main-write div.area3 div.vitaminC{
      margin-right: 5%;
    }

    div.main-board section.main-write div.area4 div.form-group4 {
      width: 22%;
      float: left;

    }

    div.main-board section.main-write div.area4 div.calcium,
    div.main-board section.main-write div.area4 div.iron,
    div.main-board section.main-write div.area4 div.magnesium {
      margin-right: 4%;
    }

    div.main-board section.main-write div.area5 {
      margin-bottom: 65px;
    }

    div.main-board section.main-write div.area5 textarea {
      height: 200px;
    }

    div.main-board section.main-write div.area5 textarea:focus {
      outline: none;
      box-shadow: none;
    }

    div.main-board section.main-write div.area6 button {
      border: 2px solid lightgray;
      border-radius: 2em;
    }

    div.main-board section.main-write div.area6 button:hover {
      color: #fff;
      background-color: lightgray;
      cursor: pointer;
      font-weight: 700;
    }

    #navbar-header .dropdown .dropdown-menu {
      top: 80%;
      display: none;
    }

    #navbar-header .dropdown {
      top: 65%;
      height: 1px;
    }

    div.flex-column li a.dropdown-item{ /*drop aÌÉúÍ∑∏ height ÌÅ¨Í∏∞*/
      padding-top: 0px;
    }

    #navbar-header .dropdown a#navibarDropdown {
      padding-top: 0px;
      top: -38px;
      position: relative;
     /* background: #FFFFFF;*/
      border-radius: 1em;
      padding: 6px;
      padding-left: 25px;
      padding-right: 25px;
    }

    #navbar-header .dropdown a#navibarDropdown2{
      padding-top: 0px;
      top: -38px;
      position: relative;
      /*background: #FFFFFF;*/
      border-radius: 1em;
      padding: 6px;
      padding-left: 25px;
      padding-right: 25px;
    }

    #replies {
        width: 46%;
        margin: 0 auto 30px;
    }

    /*div.card-body a{*/
    /*  color: black;*/
    /*  font-weight: 700;*/
    /*}*/

    #modify{
      width: 120px;
      height: 45px;
      border: 0;
      border-radius: 2em;
      margin-top: 15px;
      margin-bottom: 10px;
      background-color: whitesmoke;
      border: 1px solid black;
      font-weight: 800;
      /*position: absolute;*/
      /*top: 97%;*/
      /*left: 80%;*/
      font-size: 14px;
      z-index: 2000;
      float: right;
      margin-right: 10px;
    }

    #modify:hover{
      color: orangered;
      background-color: lightgrey;
      cursor: pointer;
      font-weight: 700;
    }

    #delete{
      width: 120px;
      height: 45px;
      border: 0;
      border-radius: 2em;
      margin-top: 15px;
      margin-bottom: 10px;
      font-size: 14px;
      background-color: whitesmoke;
      border: 1px solid black;
      font-weight: 800;
      /*position: absolute;*/
      /*top: 97%;*/
      /*left: 80%;*/
      float: right;
      z-index: 2000;
      color: black;
    }

    #delete:hover{
      color: orangered;
      background-color: lightgrey;
      cursor: pointer;
      font-weight: 700;
    }


  </style>
</head>

<div data-spy="scroll" data-target="#navbar" class="static-layout">
  <div class="boxed-page">
    <nav id="navbar-header" class="navbar navbar-expand-lg">
      <div class="container">

              <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
                  <ul id="ulwidth" class="navbar-nav d-flex justify-content-between ">
                      <div class="d-flex flex-lg-row flex-column justify-content-around widthpx">
                          <li class="nav-item active2">
                              <a class="nav-link" id="home" href="/">Home<span class="sr-only">(current)</span></a>
                          </li>

                          <li class="nav-item active3">
                              <a class="nav-link" id="list" href="/food/list">List</a>
                          </li>

            </div>
            <div class="flex-column titlewidth justify-content-center">
              <p id="title">ùìòùì∑ùìØùì∏ùì∂ùì™ùìΩùì≤ùì∏ùì∑</p>
            </div>

                      <div class="d-flex flex-lg-row flex-column justify-content-around widthpx " id="board-drop" >
                          <li class="nav-item dropdown" id="nav-li">
                              <a class="nav-link dropdown-toggle" id="navibarDropdown" role="button"
                                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  Ï†ïÎ≥¥Í≤åÏãúÌåê
                              </a>
                              <div class="dropdown-menu"  aria-labelledby="navbarDropdown">
                                  <a class="dropdown-item"
                                     onclick="location.href='/board/freeBoard'">ÏûêÏú†Í≤åÏãúÌåê</a>
                                  <a class="dropdown-item"
                                     onclick="location.href='/board/infoBoard'">Ï†ïÎ≥¥Í≤åÏãúÌåê</a>
                                  <a class="dropdown-item"
                                     onclick="location.href='/board/suggestionBoard'">Î¨∏ÏùòÍ≤åÏãúÌåê</a>
                              </div>

              </li>
              <c:if test="${empty loginUser}">
                <li class="nav-item sign active4">
                  <a class="nav-link" id="sign-in" href="/member/sign-in">Î°úÍ∑∏Ïù∏</a>
                </li>
              </c:if>


              <c:if test="${!empty loginUser}">
                <%--<li class="nav-item sign active5">
                    <a class="nav-link" id="loginAccount" onclick="location.href='/member/info/${loginUser.account}'">${loginUser.name}Îãò</a>
                </li>
                <li class="nav-item sign">
                    <a class="nav-link" id="sign-out" href="/member/sign-out">Î°úÍ∑∏ÏïÑÏõÉ</a>
                </li>--%>

                              <li class="nav-item dropdown" id="nav-li">
                                  <a class="nav-link dropdown-toggle" id="navibarDropdown2" role="button"
                                     data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                          ${loginUser.name}Îãò
                                  </a>
                                  <div class="dropdown-menu"  aria-labelledby="navbarDropdown">
                                      <a class="dropdown-item"
                                         href="/member/info/${loginUser.account}">ÎßàÏù¥ ÌéòÏù¥ÏßÄ</a>
                                      <a class="dropdown-item"
                                         id="sign-out" href="/member/sign-out">Î°úÍ∑∏ÏïÑÏõÉ</a>
                                  </div>

                </li>
              </c:if>
            </div>
          </ul>
        </div>
      </div>
    </nav>


    <div class="main-board">
      <section class="main-write">
        <div class="h1-title">
          <h1 id="h1-title"></h1>
        </div>

        <form>

          <div class="area1">
            <div class="form-group1 foodName">
              <label for="foodName" >ÏùåÏãù Ïù¥Î¶Ñ</label>
              <input style="background-color: white" type="text" class="form-control" name="name" id="foodName" value="${fo.foodName}" disabled>
            </div>

            <div class="form-group1 foodKcal">
              <label for="foodKcal">ÏπºÎ°úÎ¶¨</label>
              <input  style="background-color: white"  type="number" class="form-control" name="foodKcal" id="foodKcal" value="${mn.mfood.kcal}"placeholder="kcal" disabled>
            </div>

            <div class="form-group1 sodium">
              <label for="sodium">ÎÇòÌä∏Î•®</label>
              <input  style="background-color: white"  type="number" class="form-control" name="sodium"  value="${mn.sodium}"id="sodium" disabled>
            </div>
          </div>

          <div class="area2">
            <div class="form-group2 carbohydrate">
              <label for="carbohydrate">ÌÉÑÏàòÌôîÎ¨º</label>
              <input  style="background-color: white"  type="number" class="form-control" name="carbohydrate"value="${mn.carbohydrate}" id="carbohydrate" disabled>
            </div>

            <div class="form-group2 protein">
              <label for="protein">Îã®Î∞±Ïßà</label>
              <input  style="background-color: white"  type="number" class="form-control" name="protein" value="${mn.protein}"id="protein" disabled>
            </div>

            <div class="form-group2 fat">
              <label for="fat">ÏßÄÎ∞©</label>
              <input  style="background-color: white"  type="number" class="form-control" name="fat" value="${mn.fat}" id="fat" disabled>
            </div>
          </div>

          <div class="area3">
            <div class="form-group3 vitaminA">
              <label for="vitaminA">ÎπÑÌÉÄÎØº A</label>
              <input  style="background-color: white"  type="number" class="form-control" name="vitaminA" value="${mn.vitaminA}" id="vitaminA" disabled>
            </div>

            <div class="form-group3 vitaminC">
              <label for="vitaminC">ÎπÑÌÉÄÎØº C</label>
              <input  style="background-color: white"  type="number" class="form-control" name="vitaminC" value="${mn.vitaminC}" id="vitaminC" disabled>
            </div>

            <div class="form-group3 vitaminE">
              <label for="vitaminE">ÎπÑÌÉÄÎØº E</label>
              <input  style="background-color: white"  type="number" class="form-control" name="vitaminE" value="${mn.vitaminE}" id="vitaminE" disabled>
            </div>
          </div>

          <div class="area4">
            <div class="form-group4 calcium">
              <label for="calcium">ÏπºÏäò</label>
              <input  style="background-color: white"  type="number" class="form-control" name="calcium" value="${mn.calcium}" id="calcium" disabled>
            </div>

            <div class="form-group4 iron">
              <label for="iron">Ï≤†Î∂Ñ</label>
              <input  style="background-color: white"  type="number" class="form-control" name="iron" value="${mn.iron}" id="iron" disabled>
            </div>

            <div class="form-group4 magnesium">
              <label for="magnesium">ÎßàÍ∑∏ÎÑ§Ïäò</label>
              <input  style="background-color: white"  type="number" class="form-control" name="magnesium" value="${mn.magnesium}"  id="magnesium" disabled>
            </div>

            <div class="form-group4 omega">
              <label for="omega">Ïò§Î©îÍ∞Ä3</label>
              <input  style="background-color: white"  type="number" class="form-control" name="omega" value="${mn.omega}"  id="omega" disabled>
            </div>


          </div>





          <div class="area5">
            <label for="content">ÎÇ¥Ïö©</label>
            <textarea  style="background-color: white"  type="text" class="form-control" name="content" id="content" disabled>${fo.content}</textarea>

            <c:if test="${ir.value !=1 && ir.value !=-1 }">
              <button class="btn btn-info recbutton" type="button" id="recommend"><i class="far fa-thumbs-up"></i> ${ir.reCount}</button>
              <button class="btn btn-info recbutton" type="button" id="unrecommend"><i class="far fa-thumbs-down"></i> ${ir.ueCount}</button>
            </c:if>
            <c:if test="${ir.value == 1 }">
              <button class="btn btn-info recbutton" type="button" id="alrecommend"><i class="fas fa-thumbs-up"></i> ${ir.reCount}</button>
              <button class="btn btn-info recbutton" type="button" id="unrecommend"><i class="far fa-thumbs-down"></i> ${ir.ueCount}</button>
            </c:if>

            <c:if test="${ir.value == -1 }">
              <button class="btn btn-info recbutton" type="button" id="recommend"><i class="far fa-thumbs-up"></i> ${ir.reCount}</button>
              <button class="btn btn-info recbutton" type="button" id="alunrecommend"><i class="fas fa-thumbs-down"></i> ${ir.ueCount}</button>
            </c:if>

            <c:if test="${loginUser.account == fo.writer || loginUser.grade == 'admin'}">
              <button type="button" id="delete" >ÏÇ≠Ï†ú</button>
              <button type="button" id="modify" >ÏàòÏ†ï</button>
            </c:if>
          </div>

        </form>
      </section>
    </div>


  </div>
</div>

<div class="boxed-page-bottom">
  <!-- ÎåìÍ∏Ä ÏòÅÏó≠ -->

  <div id="replies" class="row">
    <div class="offset-md-1 col-md-10">
      <!-- ÎåìÍ∏Ä Ïì∞Í∏∞ ÏòÅÏó≠ -->
      <div class="card">
        <div class="card-body">

          <c:if test="${empty loginUser}">
            <a href="/member/sign-in">ÎåìÍ∏ÄÏùÄ Î°úÍ∑∏Ïù∏ ÌõÑ ÏûëÏÑ± Í∞ÄÎä•Ìï©ÎãàÎã§.</a>
          </c:if>

          <c:if test="${not empty loginUser}">
            <div class="row">
              <div class="col-md-9">
                <div class="form-group">
                  <label for="newReplyText" hidden>ÎåìÍ∏Ä ÎÇ¥Ïö©</label>
                  <textarea rows="3" id="newReplyText" name="replyText" class="form-control"
                            placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."></textarea>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label for="newReplyWriter" hidden>ÎåìÍ∏Ä ÏûëÏÑ±Ïûê</label>
                  <input id="newReplyWriter" name="replyWriter" type="text"
                         value="${loginUser.account}" class="form-control" placeholder="ÏûëÏÑ±Ïûê Ïù¥Î¶Ñ"
                         readonly style="margin-bottom: 6px;">
                  <button id="replyAddBtn" type="button" class="btn btn-dark form-control" style="background: whitesmoke; color:black">Îì±Î°ù
                  </button>
                </div>
              </div>
            </div>
          </c:if>
        </div>
      </div> <!-- end reply write -->

      <!--ÎåìÍ∏Ä ÎÇ¥Ïö© ÏòÅÏó≠-->
      <div class="card">
        <!-- ÎåìÍ∏Ä ÎÇ¥Ïö© Ìó§Îçî -->
        <div class="card-header text-white m-0" style="background: whitesmoke;">
          <div class="float-left" style="color: black; font-weight: 700">ÎåìÍ∏Ä (<span id="replyCnt">0</span>)</div>
        </div>

        <!-- ÎåìÍ∏Ä ÎÇ¥Ïö© Î∞îÎîî -->
        <div id="replyCollapse" class="card">
          <div id="replyData">
            <!--
            < JSÎ°ú ÎåìÍ∏Ä Ï†ïÎ≥¥ DIVÏÇΩÏûÖ >
        -->
          </div>

          <!-- ÎåìÍ∏Ä ÌéòÏù¥Ïßï ÏòÅÏó≠ -->
          <ul class="pagination justify-content-center">
            <!--
            < JSÎ°ú ÎåìÍ∏Ä ÌéòÏù¥Ïßï DIVÏÇΩÏûÖ >
        -->
          </ul>
        </div>
      </div> <!-- end reply content -->
    </div>
  </div> <!-- end replies row -->


  <!-- ÎåìÍ∏Ä ÏàòÏ†ï Î™®Îã¨ -->
  <div class="modal fade bd-example-modal-lg" id="replyModifyModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header" style="background: #343A40; color: white;">
          <h4 class="modal-title">ÎåìÍ∏Ä ÏàòÏ†ïÌïòÍ∏∞</h4>
          <button type="button" class="close text-white" data-bs-dismiss="modal">X</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <div class="form-group">
            <input id="modReplyId" type="hidden">
            <label for="modReplyText" hidden>ÎåìÍ∏ÄÎÇ¥Ïö©</label>
            <textarea id="modReplyText" class="form-control" placeholder="ÏàòÏ†ïÌï† ÎåìÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                      rows="3"></textarea>
          </div>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button id="replyModBtn" type="button" class="btn btn-dark">ÏàòÏ†ï</button>
          <button id="modal-close" type="button" class="btn btn-danger"
                  data-bs-dismiss="modal">Îã´Í∏∞
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- end replyModifyModal -->

</div>


</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" defer></script>

<script>
  const $modBtn = document.getElementById('modify');
  const $delBtn = document.getElementById('delete');

  if ($modBtn !== null) {
    //ÏàòÏ†ïÎ≤ÑÌäº
    $modBtn.onclick = e => {
      location.href = '/board/infoBoard/modify?infoNo=${fo.infoNo}';
    };
  }

  if ($delBtn !== null) {
    //ÏÇ≠Ï†úÎ≤ÑÌäº
    $delBtn.onclick = e => {
      if (!confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        return;
      }
      location.href = '/board/infoBoard/delete?infoNo=${fo.infoNo}';
    };
  }
</script>

<!-- ÎåìÍ∏ÄÍ¥ÄÎ†® script -->
<script>

  // Î°úÍ∑∏Ïù∏Ìïú ÌöåÏõê Í≥ÑÏ†ïÎ™Ö
  const currentAccount = '${loginUser.account}';
  const grade = '${loginUser.grade}';

  //ÏõêÎ≥∏ Í∏Ä Î≤àÌò∏
  const bno = '${fo.infoNo}';
  console.log('bno:', bno);

  // ÎåìÍ∏Ä ÏöîÏ≤≠ URL
  const URL = '/api/v1/inforeplies';

  //ÎÇ†Ïßú Ìè¨Îß∑ Î≥ÄÌôò Ìï®Ïàò
  function formatDate(datetime) {
    //Î¨∏ÏûêÏó¥ ÎÇ†Ïßú Îç∞Ïù¥ÌÑ∞Î•º ÎÇ†ÏßúÍ∞ùÏ≤¥Î°ú Î≥ÄÌôò
    const dateObj = new Date(datetime);
    // console.log(dateObj);
    //ÎÇ†ÏßúÍ∞ùÏ≤¥Î•º ÌÜµÌï¥ Í∞Å ÎÇ†Ïßú Ï†ïÎ≥¥ ÏñªÍ∏∞
    let year = dateObj.getFullYear();
    //1ÏõîÏù¥ 0ÏúºÎ°ú ÏÑ§Ï†ïÎêòÏñ¥ÏûàÏùå.
    let month = dateObj.getMonth() + 1;
    let day = dateObj.getDate();
    let hour = dateObj.getHours();
    let minute = dateObj.getMinutes();
    //Ïò§Ï†Ñ, Ïò§ÌõÑ ÏãúÍ∞ÑÏ≤¥ÌÅ¨
    let ampm = '';
    if (hour < 12 && hour >= 6) {
      ampm = 'Ïò§Ï†Ñ';
    } else if (hour >= 12 && hour < 21) {
      ampm = 'Ïò§ÌõÑ';
      if (hour !== 12) {
        hour -= 12;
      }
    } else if (hour >= 21 && hour <= 24) {
      ampm = 'Î∞§';
      hour -= 12;
    } else {
      ampm = 'ÏÉàÎ≤Ω';
    }
    //Ïà´ÏûêÍ∞Ä 1ÏûêÎ¶¨Ïùº Í≤ΩÏö∞ 2ÏûêÎ¶¨Î°ú Î≥ÄÌôò
    (month < 10) ? month = '0' + month : month;
    (day < 10) ? day = '0' + day : day;
    (hour < 10) ? hour = '0' + hour : hour;
    (minute < 10) ? minute = '0' + minute : minute;
    return year + "-" + month + "-" + day + " " + ampm + " " + hour + ":" + minute;
  }


  // ÎåìÍ∏Ä ÌéòÏù¥ÏßÄ ÌÉúÍ∑∏ ÏÉùÏÑ± Î†åÎçîÎßÅ Ìï®Ïàò
  function makePageDOM(pageInfo) {
    let tag = "";
    const begin = pageInfo.beginPage;
    const end = pageInfo.endPage;
    //Ïù¥Ï†Ñ Î≤ÑÌäº ÎßåÎì§Í∏∞
    if (pageInfo.prev) {
      tag += "<li class='page-item'><a class='page-link page-active' href='" + (begin - 1) +
              "'>Ïù¥Ï†Ñ</a></li>";
    }
    //ÌéòÏù¥ÏßÄ Î≤àÌò∏ Î¶¨Ïä§Ìä∏ ÎßåÎì§Í∏∞
    for (let i = begin; i <= end; i++) {
      let active = '';
      if (pageInfo.page.pageNum === i) {
        active = 'p-active';
      }

      tag += "<li class='page-item " + active + "'><a class='page-link page-custom' href='" + i +
              "'>" + i + "</a></li>";
    }
    //Îã§Ïùå Î≤ÑÌäº ÎßåÎì§Í∏∞
    if (pageInfo.next) {
      tag += "<li class='page-item'><a class='page-link page-active' href='" + (end + 1) +
              "'>Îã§Ïùå</a></li>";
    }

    // ÌéòÏù¥ÏßÄÌÉúÍ∑∏ Î†åÎçîÎßÅ
    const $pageUl = document.querySelector('.pagination');
    $pageUl.innerHTML = tag;

    // ulÏóê ÎßàÏßÄÎßâÌéòÏù¥ÏßÄ Î≤àÌò∏ Ï†ÄÏû•.
    $pageUl.dataset.fp = pageInfo.finalPage;


  }


  // ÎåìÍ∏Ä Î™©Î°ù DOMÏùÑ ÏÉùÏÑ±ÌïòÎäî Ìï®Ïàò
  function makeReplyDOM({
                          replyList,
                          count,
                          maker
                        }) {
    // Í∞Å ÎåìÍ∏Ä ÌïòÎÇòÏùò ÌÉúÍ∑∏
    let tag = '';

    if (replyList === null || replyList.length === 0) {
      tag += "<div id='replyContent' class='card-body'></div>";

    } else {
      for (let rep of replyList) {
        tag += "<div id='replyContent' class='card-body' data-replyId='" + rep.replyNo + "'>" +
                "    <div class='row user-block'>" +
                "       <span class='col-md-3'>" +
                "         <b>" + rep.replyWriter + "</b>" +
                "       </span>" +
                "       <span class='offset-md-6 col-md-3 text-right'><b>" + formatDate(rep.replyDate) +
                "</b></span>" +
                "    </div><br>" +
                "    <div class='row'>" +
                "       <div class='col-md-6'>" + rep.replyText + "</div>" +
                "       <div class='offset-md-2 col-md-4 text-right'>";

        if (currentAccount === rep.replyWriter || grade === 'admin') {
          tag +=
                  "         <a id='replyModBtn' class='btn btn-sm btn-outline-dark' data-bs-toggle='modal' data-bs-target='#replyModifyModal'>ÏàòÏ†ï</a>&nbsp;" +
                  "         <a id='replyDelBtn' class='btn btn-sm btn-outline-dark' href='#'>ÏÇ≠Ï†ú</a>";
        }
        tag += "       </div>" +
                "    </div>" +
                " </div>";
      }
    }

    // ÎåìÍ∏Ä Î™©Î°ùÏóê ÏÉùÏÑ±Îêú DOM Ï∂îÍ∞Ä
    document.getElementById('replyData').innerHTML = tag;

    // ÎåìÍ∏Ä Ïàò Î∞∞Ïπò
    document.getElementById('replyCnt').textContent = count;

    // ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ
    makePageDOM(maker);


  }

  // ÎåìÍ∏Ä Î™©Î°ùÏùÑ ÏÑúÎ≤ÑÎ°úÎ∂ÄÌÑ∞ ÎπÑÎèôÍ∏∞ÏöîÏ≤≠ÏúºÎ°ú Î∂àÎü¨Ïò§Îäî Ìï®Ïàò
  function showReplies(pageNum = 1) {

    fetch(URL + '?infoNo=' + bno + '&pageNum=' + pageNum)
            .then(res => res.json())
            .then(replyMap => {
              // console.log(replyMap.replyList);
              makeReplyDOM(replyMap);
            });
  }

  // ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠Ïù¥Î≤§Ìä∏ Îì±Î°ù Ìï®Ïàò
  function makePageButtonClickEvent() {
    // ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    const $pageUl = document.querySelector('.pagination');
    $pageUl.onclick = e => {
      if (!e.target.matches('.page-item a')) return;

      e.preventDefault();
      // ÎàÑÎ•∏ ÌéòÏù¥ÏßÄ Î≤àÌò∏ Í∞ÄÏ†∏Ïò§Í∏∞
      const pageNum = e.target.getAttribute('href');
      // console.log(pageNum);

      // ÌéòÏù¥ÏßÄ Î≤àÌò∏Ïóê ÎßûÎäî Î™©Î°ù ÎπÑÎèôÍ∏∞ ÏöîÏ≤≠
      showReplies(pageNum);
    };
  }

  // ÎåìÍ∏Ä Îì±Î°ù Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ Ìï∏Îì§Îü¨ Îì±Î°ù Ìï®Ïàò
  function makeReplyRegisterClickEvent() {

    document.getElementById('replyAddBtn').onclick = makeReplyRegisterClickHandler;
  }


  // ÎåìÍ∏Ä Îì±Î°ù Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ Ìï∏Îì§Îü¨ Ìï®Ïàò
  function makeReplyRegisterClickHandler(e) {

    const $writerInput = document.getElementById('newReplyWriter');
    const $contentInput = document.getElementById('newReplyText');

    // ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°Ìï† Îç∞Ïù¥ÌÑ∞Îì§
    const replyData = {
      replyWriter: $writerInput.value,
      replyText: $contentInput.value,
      infoNo : bno
    };

    // POSTÏöîÏ≤≠ÏùÑ ÏúÑÌïú ÏöîÏ≤≠ Ï†ïÎ≥¥ Í∞ùÏ≤¥
    const reqInfo = {
      method: 'POST',
      headers: {
        'content-type': 'application/json'
      },
      body: JSON.stringify(replyData)
    };

    fetch(URL, reqInfo)
            .then(res => res.text())
            .then(msg => {
              if (msg === 'insert-success') {
                alert('ÎåìÍ∏Ä Îì±Î°ù ÏÑ±Í≥µ');
                // ÎåìÍ∏Ä ÏûÖÎ†•Ï∞Ω Î¶¨ÏÖã
                // $writerInput.value = '';
                $contentInput.value = '';
                // ÎåìÍ∏Ä Î™©Î°ù Ïû¨ÏöîÏ≤≠
                showReplies(document.querySelector('.pagination').dataset.fp);
              } else {
                alert('ÎåìÍ∏Ä Îì±Î°ù Ïã§Ìå®');
              }
            });
  }

  // ÎåìÍ∏Ä ÏàòÏ†ïÌôîÎ©¥ Ïó¥Í∏∞ ÏÉÅÏÑ∏Ï≤òÎ¶¨
  function processModifyShow(e, rno) {

    // console.log('ÏàòÏ†ïÎ≤ÑÌäº ÌÅ¥Î¶≠Ìï®!! after');

    // ÌÅ¥Î¶≠Ìïú Î≤ÑÌäº Í∑ºÏ≤òÏóê ÏûàÎäî ÎåìÍ∏Ä ÎÇ¥Ïö©ÌÖçÏä§Ìä∏Î•º ÏñªÏñ¥Ïò®Îã§.
    const replyText = e.target.parentElement.parentElement.firstElementChild.textContent;
    console.log('ÏàòÏ†ï ÎåìÍ∏ÄÎÇ¥Ïö©:', replyText);

    // Î™®Îã¨Ïóê Ìï¥Îãπ ÎåìÍ∏ÄÎÇ¥Ïö©ÏùÑ Î∞∞ÏπòÌïúÎã§.
    document.getElementById('modReplyText').value = replyText;

    // Î™®Îã¨ÏùÑ ÎùÑÏö∏ Îïå Îã§Ïùå ÏûëÏóÖ(ÏàòÏ†ïÏôÑÎ£åÏ≤òÎ¶¨)ÏùÑ ÏúÑÌï¥ ÎåìÍ∏ÄÎ≤àÌò∏Î•º Î™®Îã¨Ïóê Îã¨ÏïÑÎëêÏûê.
    const $modal = document.querySelector('.modal');
    $modal.dataset.rno = rno;
  }

  // ÎåìÍ∏Ä ÏÇ≠Ï†ú ÏÉÅÏÑ∏Ï≤òÎ¶¨
  function processRemove(rno) {
    if (!confirm('ÏßÑÏßúÎ°ú ÏÇ≠Ï†úÌï©ÎãàÍπå??')) return;

    fetch(URL + '/' + rno, {
      method: 'DELETE'
    })
            .then(res => res.text())
            .then(msg => {
              if (msg === 'del-success') {
                alert('ÏÇ≠Ï†ú ÏÑ±Í≥µ!!');
                showReplies(); // ÎåìÍ∏Ä ÏÉàÎ°úÎ∂àÎü¨Ïò§Í∏∞
              } else {
                alert('ÏÇ≠Ï†ú Ïã§Ìå®!!');
              }
            });
  }


  // ÎåìÍ∏Ä ÏàòÏ†ïÌôîÎ©¥ Ïó¥Í∏∞, ÏÇ≠Ï†ú Ï≤òÎ¶¨ Ìï∏Îì§Îü¨ Ï†ïÏùò
  function makeReplyModAndDelHandler(e) {

    const rno = e.target.parentElement.parentElement.parentElement.dataset.replyid;
    console.log('mod get rno: ', rno);

    e.preventDefault();

     console.log('ÏàòÏ†ïÎ≤ÑÌäº ÌÅ¥Î¶≠Ìï®!! before');
    if (e.target.matches('#replyModBtn')) {
      processModifyShow(e, rno);
    } else if (e.target.matches('#replyDelBtn')) {
      processRemove(rno);
    }
  }

  // ÎåìÍ∏Ä ÏàòÏ†ï ÌôîÎ©¥ Ïó¥Í∏∞, ÏÇ≠Ï†ú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
  function openModifyModalAndRemoveEvent() {

    const $replyData = document.getElementById('replyData');
    $replyData.onclick = makeReplyModAndDelHandler;
  }

  // ÎåìÍ∏Ä ÏàòÏ†ï ÎπÑÎèôÍ∏∞ Ï≤òÎ¶¨ Ïù¥Î≤§Ìä∏
  function replyModifyEvent() {

    const $modal = $('#replyModifyModal');

    document.getElementById('replyModBtn').onclick =
            e => {
               console.log('ÏàòÏ†ï ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠!');

              // ÏÑúÎ≤ÑÏóê ÏàòÏ†ï ÎπÑÎèôÍ∏∞ ÏöîÏ≤≠ Î≥¥ÎÇ¥Í∏∞
              const rno = e.target.closest('.modal').dataset.rno;
              console.log('mod post rno', rno);

              const reqInfo = {
                method: 'PUT',
                headers: {
                  'content-type': 'application/json'
                },
                body: JSON.stringify({
                  replyText: $('#modReplyText').val(),
                  replyNo: rno
                })
              };


              fetch(URL + '/' + rno, reqInfo)
                      .then(res => res.text())
                      .then(msg => {
                        if (msg === 'mod-success') {
                          alert('ÏàòÏ†ï ÏÑ±Í≥µ!!');
                          $modal.modal('hide'); // Î™®Îã¨Ï∞Ω Îã´Í∏∞
                          showReplies(); // ÎåìÍ∏Ä ÏÉàÎ°úÎ∂àÎü¨Ïò§Í∏∞
                        } else {
                          alert('ÏàòÏ†ï Ïã§Ìå®!!');
                        }
                      });
            };
  }


  // Î©îÏù∏ Ïã§ÌñâÎ∂Ä
  (function () {

    // Ï¥àÍ∏∞ ÌôîÎ©¥ Î†åÎçîÎßÅÏãú ÎåìÍ∏Ä 1ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ
    showReplies();

    // ÎåìÍ∏Ä ÌéòÏù¥ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    makePageButtonClickEvent();

    // ÎåìÍ∏Ä Îì±Î°ù Î≤ÑÌäº ÌÅ¥Î¶≠Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    makeReplyRegisterClickEvent();

    // ÎåìÍ∏Ä ÏàòÏ†ï Î™®Îã¨ Ïò§Ìîà, ÏÇ≠Ï†ú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    openModifyModalAndRemoveEvent();

    // ÎåìÍ∏Ä ÏàòÏ†ï ÏôÑÎ£å Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    replyModifyEvent();


  })();
</script>

<!--Ï∂îÏ≤ú ÎπÑÏ∂îÏ≤ú Í¥ÄÎ†®-->
<script>
  const member ='${loginUser.account}';
  const infoNo=${fo.infoNo};
  const $recbtn = document.querySelectorAll(".recbutton");


  const RURL = '/api/v1/recommend';
  const URURL = '/api/v1/unrecommend';
  function showRecommend(ir){
    $recbtn[0].innerHTML='<i class="fas fa-thumbs-up">'+" "+ ir.reCount;
    $recbtn[0].setAttribute("id",'alrecommend');
    $recbtn[1].innerHTML='<i class="far fa-thumbs-down">'+" "+ ir.ueCount;
    $recbtn[1].setAttribute("id",'unrecommend');
  }

  function showAlRecommend(ir){
    $recbtn[0].innerHTML='<i class="far fa-thumbs-up">'+" "+ ir.reCount;
    $recbtn[0].setAttribute("id",'recommend');
    $recbtn[1].innerHTML='<i class="far fa-thumbs-down">'+" "+ ir.ueCount;
    $recbtn[1].setAttribute("id",'unrecommend');
  }

  function showURecommend(ir){
    $recbtn[0].innerHTML='<i class="far fa-thumbs-up">'+" "+ ir.reCount;
    $recbtn[0].setAttribute("id",'recommend');
    $recbtn[1].innerHTML='<i class="fas fa-thumbs-down">'+" "+ ir.ueCount;
    $recbtn[1].setAttribute("id",'alunrecommend');
  }

  function showAlURecommend(ir){
    $recbtn[0].innerHTML='<i class="far fa-thumbs-up">'+" "+ ir.reCount;
    $recbtn[0].setAttribute("id",'recommend');
    $recbtn[1].innerHTML='<i class="far fa-thumbs-down">'+" "+ ir.ueCount;
    $recbtn[1].setAttribute("id",'unrecommend');
  }

  function recommend(infoNo) {
    fetch(RURL + '?infoNo=' + infoNo)
            .then(res => res.json())
            .then(ir => {
              showRecommend(ir);
            });
  }

  function unrecommend(infoNo) {
      fetch(URURL + '?infoNo=' + infoNo)
          .then(res => res.json())
          .then(ir => {
              showURecommend(ir);
          });
  }

  function deleteR(infoNo){
    fetch(RURL + '?infoNo=' + infoNo,{method:'delete'})
            .then(res => res.json())
            .then(ir => {
              showAlRecommend(ir);
            });
  }


  function deleteUR(infoNo){
    fetch(URURL + '?infoNo=' + infoNo,{method:'delete'})
            .then(res => res.json())
            .then(ir => {
              showAlURecommend(ir);
            });
  }



    $recbtn[0].onclick = e => {
    if(member!==''){
        if($recbtn[0].getAttribute("id")=="recommend") {
          recommend(infoNo);
        }else if($recbtn[0].getAttribute("id")=="alrecommend"){
          deleteR(infoNo);
        }
      }else{
      alert("Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.")
      }
    }

  $recbtn[1].onclick = e => {
    if(member!=='') {
      if ($recbtn[1].getAttribute("id") == "unrecommend") {
        unrecommend(infoNo);
      } else if ($recbtn[1].getAttribute("id") == "alunrecommend") {
        deleteUR(infoNo);
      }
    }else{
      alert("Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.")
    }
  }





</script>


</html>
